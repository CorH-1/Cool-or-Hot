{% extends 'base.html' %}
{% load static %}
{% block link %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{% static 'css/carousel.css' %}">
  <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock link %}
{% block title %}post_detail{% endblock title %}
{% block content %}
  <div class="container-md">

    <!-- 임시로 만든 navbar -->
    <div class="navbar_box">
      <h1>post_detail</h1>
      <a href="{% url 'posts:index' %}">Home</a>
      <a href="{% url 'posts:where' %}">[내 근처 모임 찾기]</a>
      <a href="{% url 'posts:post_create' %}">[CREATE]</a>
      {% if request.user.is_authenticated %}
        <h3>안녕하세요,{{ user }}님!</h3>
        <a href="{% url 'accounts:profile' user.username %}">내 프로필</a>
        <form action="{% url 'accounts:logout' %}" method="POST">
          {% csrf_token %}
          <input type="submit" value="Logout">
        </form>
      {% else %}
        <a href="{% url 'accounts:login' %}">Login</a>
        <a href="{% url 'accounts:signup' %}">Signup</a>
      {% endif %}
    </div>

    <!-- ## 화면 상단 케로젤+정보 ## -->
    <div class="row">
      <!-- 케로젤 -->
      <div class="post_detail_carousel_container col-md-8 my-3" style="height: 600px">
        <div class="carousel">
          <div class="slides">
            {% for image in post_images %}
              <img class="slide" src="{{ image.image.url }}" alt="Slide 1">
            {% endfor %}
          </div>
          <button class="prev-button">&lt;</button>
          <button class="next-button">&gt;</button>
          <div class="dots">
            <button class="dot"></button>
            <button class="dot"></button>
            <button class="dot"></button>
          </div>
        </div>
      </div>
      <!-- 정보 -->
      <div class="post_info col p-4">
        <h1 class="title">{{ post.title }}</h1>
        <p class="title">{{ post.content }}</p>
        <p class="title">조회수 : {{ post.hits }}</p>
        <p class="title">카테고리 : {{ post.category }}</p>
        <p class="title">
          {% for tag in post.tags.all %}
            태그: #{{ tag.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </p>
        <div class="my-2">
          {% if request.user == post.user %}
            {% if user.is_superuser or user.is_staff %}
              <form class="d-inline" action="{% url 'posts:post_delete' post.pk  %}" method="POST">
                {% csrf_token %}
                <input class="btn btn-dark btn-sm" type="submit" value="삭제">
              </form>
              <a class="btn btn-dark btn-sm" href="{% url 'posts:post_update' post.pk %}">
                <i class="bi bi-pencil-square"></i>modify</a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>

    <!-- 이미지 나열 -->
    <div class="container-md post_detail_content">
      {% for image in post_images %}
        <img class="col" src="{{ image.image.url }}" alt="">
      {% endfor %}
    </div>

    <!-- 댓글-->
    <div class="comments row p-3">
      <h4>댓글 목록</h4>
      <hr>
      {% for comment in post_comments %}
        <div class="">
          <p>{{ comment.content }}</p>
          <span class="d-inline text-muted">{{ comment.user }}
            |
            {{ comment.created_string }}
            {% if request.user == comment.user %}
              <form class="d-inline" action="{% url 'posts:post_comments_delete' post.pk comment.pk %}" method="POST">
                {% csrf_token %}
                <input type="submit" class="btn btn-outline-secondary btn-sm ms-5" value="삭제">
              </form>
            {% endif %}
          </span>
        </div>
      {% endfor %}

      <form class="mt-4" action="{% url 'posts:post_comments_create' post.pk %}" method="POST">
        {% csrf_token %}
        {{ post_comment_form }}
        <input type="submit">
      </form>
    </div>

  </div>
{% endblock content %}
{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="{% static 'js/index.js' %}"></script>
  <script src="{% static 'js/carousel.js' %}"></script>
{% endblock script %}
