<html>
<head>
	<meta charset="utf-8"/>
	<title>MAP</title>
</head>
<body>
  <a href="{% url 'posts:index' %}">[MAIN PAGE]</a>
	<div id="map" style="width:500px;height:500px;"></div>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cb746573691fe924faae69321b18243c"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showMap, showError, { enableHighAccuracy: true });
				} else {
					alert("브라우저에서 위치 정보를 지원하지 않습니다.");
				}
			}

			function showMap(position) {
				var latitude = position.coords.latitude;
				var longitude = position.coords.longitude;
				var altitude = position.coords.altitude;

				var container = document.getElementById('map');
				var options = {
					center: new kakao.maps.LatLng(latitude, longitude),
					level: 4
				};

				// 고도 정보를 이용하여 지도의 높이를 조정
				if (altitude) {
					options.height = altitude;
				}

        var map = new kakao.maps.Map(container, options);

        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png';
        var imageSize = new kakao.maps.Size(30, 40);
        var imageOption = { offset: new kakao.maps.Point(27, 69) };
      
        // 현재 위치에 마커 추가
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
        var markerPosition = new kakao.maps.LatLng(latitude, longitude);
      
        var marker = new kakao.maps.Marker({
          position: markerPosition,
          image: markerImage
        });
      
        marker.setMap(map);
      
        // 임시 근처 소모임 데이터
				var gatheringData = [
        {
          name: "소모임1",
          latlng: new kakao.maps.LatLng(37.507683, 126.736127),
          description: "설명1",
          contact: "연락처1"
        },
        {
          name: "소모임2",
          latlng: new kakao.maps.LatLng(37.507663, 126.731986),
          description: "설명2",
          contact: "연락처2"
        },
        {
          name: "소모임3",
          latlng: new kakao.maps.LatLng(37.509262, 126.737332),
          description: "설명3",
          contact: "연락처3"
        }
        // 추가적인 소모임 데이터를 원하는 개수만큼 이곳에 추가해주세요
      ];

      // 근처 소모임 데이터를 기반으로 마커 생성 및 표시
      gatheringData.forEach(function(data) {
        var marker = new kakao.maps.Marker({
          position: data.latlng,
          map: map
        });

        // 마커를 클릭하는 이벤트 핸들러 등록
        kakao.maps.event.addListener(marker, 'click', function() {
          showGatheringInfo(data);
        });
      });
    }

    function showError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("위치 정보 제공이 거부되었습니다.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("위치 정보를 사용할 수 없습니다.");
          break;
        case error.TIMEOUT:
          alert("위치 정보를 가져오는 데 시간이 초과되었습니다.");
          break;
        case error.UNKNOWN_ERROR:
          alert("알 수 없는 오류가 발생했습니다.");
          break;
      }
    }

			// 페이지 로드 시 바로 모달 창 표시 및 위치 정보 요청
			getLocation();
		});
	</script>
</body>
</html>
